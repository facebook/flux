<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Flux | Application Architecture for Building User Interfaces</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Flux | Application Architecture for Building User Interfaces"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/flux/index.html"><meta property="og:description" content="Application Architecture for Building User Interfaces"><link rel="stylesheet" href="/flux/css/flux.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/flux/"><img class="nav-logo" src="/flux/img/flux_logo.svg" width="50" height="50">Flux</a><ul class="nav-site"><li><a href="/flux/docs/overview.html#content" class="active">docs</a></li><li><a href="/flux/support.html" class="">support</a></li><li><a href="http://github.com/facebook/flux" class="">github</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/overview.html#content">Overview</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/todo-list.html#content">Tutorial – Todo List</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/chat.html#content">Tutorial – Chat</a></li></ul></div><div class="nav-docs-section"><h3>Guides</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/actions-and-the-dispatcher.html#content">Actions and the Dispatcher</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/testing-flux-applications.html#content">Testing Flux Applications</a></li></ul></div><div class="nav-docs-section"><h3>Reference</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/dispatcher.html#content">Dispatcher</a></li><li><a style="margin-left:0;" class="active" href="/flux/docs/flux-utils.html#content">Flux Utils</a></li></ul></div><div class="nav-docs-section"><h3>Community Resources</h3><ul><li><a style="margin-left:0;" class="" href="/flux/docs/videos.html#content">Videos</a></li><li><a style="margin-left:0;" class="" href="/flux/docs/examples-and-tools.html#content">Examples and Tools</a></li></ul></div><div class="nav-docs-section"><h3>Complementary</h3><ul><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/react/">React – UI Library</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/immutable-js/">ImmutableJS – Immutable Data</a></li><li><a target="_blank" style="margin-left:0;" class="" href="http://facebook.github.io/jest/">Jest – Unit Testing</a></li></ul></div></div><div class="inner-content"><a id="content"></a><h1>Flux Utils</h1><div><p>Flux Utils is a set of basic utility classes to help get you started with Flux. These base classes are a solid foundation for a simple Flux application, but they are <strong>not</strong> a feature-complete framework that will handle all use cases. There are many other great Flux frameworks out there if these utilities do not fulfill your needs.</p><h2><a class="anchor" name="usage"></a>Usage <a class="hash-link" href="#usage">#</a></h2><p>There are four main classes exposed in Flux Utils:</p><ol><li>Store</li><li>ReduceStore</li><li>MapStore</li><li>Container</li></ol><p>These base classes can be imported from <code>flux/utils</code> like this:</p><div class="prism language-javascript">import <span class="token punctuation">{</span>ReduceStore<span class="token punctuation">}</span> from <span class="token string">&#x27;flux/utils&#x27;</span><span class="token punctuation">;</span>

class <span class="token class-name">CounterStore</span> extends <span class="token class-name">ReduceStore</span>&lt;number<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">getInitialState<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> number <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">reduce<span class="token punctuation">(</span></span>state<span class="token punctuation">:</span> number<span class="token punctuation">,</span> action<span class="token punctuation">:</span> Object<span class="token punctuation">)</span><span class="token punctuation">:</span> number <span class="token punctuation">{</span>
    switch <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      case <span class="token string">&#x27;increment&#x27;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

      case <span class="token string">&#x27;square&#x27;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> state <span class="token operator">*</span> state<span class="token punctuation">;</span>

      default<span class="token punctuation">:</span>
        <span class="token keyword">return</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></div><h2><a class="anchor" name="best-practices"></a>Best practices <a class="hash-link" href="#best-practices">#</a></h2><p>There are some best practices we try to follow when using these classes:</p><h3><a class="anchor" name="stores"></a>Stores <a class="hash-link" href="#stores">#</a></h3><ol><li>Cache data</li><li>Expose public getters to access data (never have public setters)</li><li>Respond to specific actions from the dispatcher</li><li>Always emit a change when their data changes</li><li>Only emit changes during a dispatch</li></ol><h3><a class="anchor" name="actions"></a>Actions <a class="hash-link" href="#actions">#</a></h3><ol><li>Describe a user&#x27;s action, are not setters. (e.g. <code>select-page</code> not <code>set-page-id</code>)</li></ol><h3><a class="anchor" name="containers"></a>Containers <a class="hash-link" href="#containers">#</a></h3><ol><li>Are react components that control a view</li><li>Primary job is to gather information from stores and save it in their state</li><li>Have no props and no UI logic</li></ol><h3><a class="anchor" name="views"></a>Views <a class="hash-link" href="#views">#</a></h3><ol><li>Are react components that are controlled by a container</li><li>Have all of the UI and rendering logic</li><li>Receive all information and callbacks as props</li></ol><h1><a class="anchor" name="api"></a>API <a class="hash-link" href="#api">#</a></h1><h2><a class="anchor" name="store"></a>Store <a class="hash-link" href="#store">#</a></h2><ul><li><p><strong>constructor(dispatcher: Dispatcher)</strong>
Constructs and registers an instance of this store with the given dispatcher.</p></li><li><p><strong>addListener(callback: Function): {remove: Function}</strong>
Adds a listener to the store, when the store changes the given callback will be called. A token is returned that can be used to remove the listener. Calling the <code>remove()</code> function on the returned token will remove the listener.</p></li><li><p><strong>getDispatcher(): Dispatcher</strong>
Returns the dispatcher this store is registered with.</p></li><li><p><strong>getDispatchToken(): DispatchToken</strong>
Returns the dispatch token that the dispatcher recognizes this store by. Can be used to <code>waitFor()</code> this store.</p></li><li><p><strong>hasChanged(): boolean</strong>
Ask if a store has changed during the current dispatch. Can only be invoked while dispatching. This can be used for constructing derived stores that depend on data from other stores.</p></li><li><p><strong>__emitChange(): void</strong>
Emit an event notifying all listeners that this store has changed. This can only be invoked when dispatching. Changes are de-duplicated and resolved at the end of this store&#x27;s <code>__onDispatch</code> function.</p></li><li><p><strong>__onDispatch(payload: Object): void</strong>
Subclasses must override this method. This is how the store receives actions from the dispatcher. All state mutation logic must be done during this method.</p></li></ul><h2><a class="anchor" name="reducestore-t"></a>ReduceStore&lt;T&gt; <a class="hash-link" href="#reducestore-t">#</a></h2><ul><li><p><strong>extends Store</strong>
This class extends the base Store.</p></li><li><p><strong>getState(): T</strong>
Getter that exposes the entire state of this store. If your state is not immutable you should override this and not expose state directly.</p></li><li><p><strong>getInitialState(): T</strong>
Constructs the initial state for this store. This is called once during construction of the store.</p></li><li><p><strong>reduce(state: T, action: Object): T</strong>
Reduces the current state, and an action to the new state of this store. All subclasses must implement this method. This method should be pure and have no side-effects.</p></li><li><p><strong>areEqual(one: T, two: T): boolean</strong>
Checks if two versions of state are the same. You do not need to override this if your state is immutable.</p></li><li><p><strong>Doesn&#x27;t need to emit a change</strong>
Note that any store that extends <code>ReduceStore</code> does not need to manually emit changes in <code>reduce()</code> (you still can if you want to though). The state is compared before and after each dispatch and changes are emitted automatically. If you need to control this behavior (perhaps because your state is mutable) override <code>areEqual()</code>.</p></li></ul><h2><a class="anchor" name="mapstore-k-v"></a>MapStore&lt;K, V&gt; <a class="hash-link" href="#mapstore-k-v">#</a></h2><ul><li><p><strong>extends ReduceStore&lt;Immutable.Map&lt;K, V&gt;&gt;</strong>
This class extends ReduceStore and defines the state as an immutable map.</p></li><li><p><strong>at(key: K): V</strong>
Access the value at the given key. throws an error if the key does not exist in the cache.</p></li><li><p><strong>has(key: K): boolean</strong>
Check if the cache has a particular key</p></li><li><p><strong>get(key: K): ?V</strong>
Get the value of a particular key. Returns undefined if the key does not exist in the cache.</p></li><li><p><strong>getAll(keys: Iterable&lt;K&gt;, prev: ?Immutable.Map&lt;K, V&gt;): Immutable.Map&lt;K, V&gt;</strong>
Gets an array of keys and puts the values in a map if they exist, it allows providing a previous result to update instead of generating a new map. Providing a previous result allows the possibility of keeping the same reference if the keys did not change.</p></li></ul><h2><a class="anchor" name="container"></a>Container <a class="hash-link" href="#container">#</a></h2><ul><li><strong>create(base: ReactClass, options: ?Object): ReactClass</strong>
Create is used to transform a react class into a container that updates its state when relevant stores change. The provided base class must have static methods <code>getStores()</code> and <code>calculateState()</code>.</li></ul><div class="prism language-javascript">import <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> from <span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span>
import <span class="token punctuation">{</span>Container<span class="token punctuation">}</span> from <span class="token string">&#x27;flux/utils&#x27;</span><span class="token punctuation">;</span>

class <span class="token class-name">CounterContainer</span> extends <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  static <span class="token function">getStores<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>CounterStore<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  static <span class="token function">calculateState<span class="token punctuation">(</span></span>prevState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      counter<span class="token punctuation">:</span> CounterStore<span class="token punctuation">.</span><span class="token function">getState<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> &lt;CounterUI counter<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

const container <span class="token operator">=</span> Container<span class="token punctuation">.</span><span class="token function">create<span class="token punctuation">(</span></span>CounterContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></div><p>Additional options may be provided when creating your container in order to control certain behaviors.</p><ul><li><p><strong>containers are pure</strong>
By default containers are pure, meaning they will not re-render when their props and state do not change (as determined by <code>shallowEquals()</code>). To disable this behavior pass options <code>{pure: false}</code> as the second argument to <code>create()</code>.</p></li><li><p><strong>containers cannot access props</strong>
By default containers are not able to access any props. This is both for performance reasons, and to ensure that containers are re-usable and props do not have to be threaded throughout a component tree. There are some valid situations in which you need to determine your state based on both props and a store&#x27;s state. In those situations pass options <code>{withProps: true}</code> as the second argument to <code>create()</code>. This will expose the components props as the second argument to <code>calculateState()</code>.</p></li></ul><p>If you are unable to utilize react classes most of this functionality is also mirrored in a mixin. <code>import {Mixin} from &#x27;flux/utils&#x27;;</code></p></div><div class="docs-prevnext"><a class="docs-next" href="videos.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">© 2014-2016 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-387204-10', 'facebook.github.io');
            ga('send', 'pageview');

            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)
            ){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script></body></html>